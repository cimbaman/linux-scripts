#!/bin/bash

# The various escape codes that we can use to color our prompt.
         RED="\[\033[0;31m\]"
       GREEN="\[\033[0;32m\]"
      YELLOW="\[\033[0;33m\]"
        BLUE="\[\033[0;34m\]"
      PURPLE="\[\033[0;35m\]"
    BOLD_RED="\[\033[1;31m\]"
  BOLD_GREEN="\[\033[1;32m\]"
 BOLD_YELLOW="\[\033[1;33m\]"
   BOLD_BLUE="\[\033[1;34m\]"
 BOLD_PURPLE="\[\033[1;35m\]"
       WHITE="\[\033[1;37m\]"
        GRAY="\[\033[0;37m\]"
  COLOR_NONE="\[\e[0m\]"

# determine git branch name
function parse_git_branch(){
  git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ (\1)/'
}

# Determine the branch/state information for this git repository.
function set_git_branch() {
  # Get the name of the branch.
  branch=$(parse_git_branch)
  BRANCH="${branch}"
}

# Determine if there are any jobs runningin the background
function set_job_running () {
  if [ $(jobs | wc -l) -eq 0 ] ;
  then  JOBNUM=""
else  JOBNUM=" [\j] "
  fi
}


# Set the full bash prompt.
function set_bash_prompt () {

  # Set the BRANCH variable.
  set_git_branch
  # Set the JOBNUM variable.
  set_job_running


  # Bash prompt that shows user:[directory] [bg]
  PS1="${debian_chroot:+($debian_chroot)}\u:[\w] ${JOBNUM}${BRANCH} \$ "

  if [ "$color_prompt" = yes ]; then
      PS1="${debian_chroot:+($debian_chroot)}${BOLD_GREEN}\u${COLOR_NONE}:${BOLD_BLUE}[\w]${COLOR_NONE}${LIGHT_RED}${JOBNUM}${COLOR_NONE}${PURPLE}${COLOR_NONE}${BRANCH} \$ "
  else
    # Bash prompt that shows user:[directory] [bg] (git) without color
    PS1="${debian_chroot:+($debian_chroot)}\u:[\w] ${JOBNUM}${BRANCH} \$ "
  fi
  unset color_prompt force_color_prompt

  # Set terminal name with time
  case "$TERM" in
  xterm*|rxvt*)
      PS1="\[\e]0;${debian_chroot:+($debian_chroot)}[\t] \u@\h: \w\a\]$PS1"
      ;;
  *)
      ;;
  esac
}

# Shorten directory to only two
PROMPT_DIRTRIM=2
# Tell bash to execute this function just before displaying its prompt.
PROMPT_COMMAND=set_bash_prompt
